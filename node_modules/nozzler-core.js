var getPrice = require('price-btc');

getPrice(init);

// - gather needed info
// - process communication
// - if end or timeout, go to next
// 
// - spawn child casperjs to process url
// - casper enters the nozzle
// - casper captures the captcha (captchure)
// - casper must hang until captcha solution
// - when solution is done, apply 
// 
// Apparently, you need to hang many processes to make available more than one challenge 
// - QUESTION: How many open sites is it possible to leave waiting at a time?
// - Is it possible to PAUSE and RESUME a session?
// 
// Você precisa separar peças relevantes, e manter o mínimo considerável disponível como um módulo atômico

function init(price) {
    var balance = require('child_process').spawn('casperjs', ['node_modules/balancer.js', 'http://bluesatoshi.com?r=weFVogcxq6K21zWXf1NnFcBCTTcmEYH4LC', price]);
    
    var final = '';
    
    balance.stdout.on('data', function (data) {
        final += data.toString();
    });

    balance.stdout.on('end', function () {
        console.log(final);
    });
}

